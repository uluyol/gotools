#!/usr/bin/env python3

import argparse
import sys

parser = argparse.ArgumentParser()
parser.add_argument("--write", action="store_true")
parser.add_argument("pattern")
parser.add_argument("toadd")
parser.add_argument("files", nargs="+")
args = parser.parse_args()

for file in args.files:
	lines = []
	with open(file) as f:
		for line in f:
			lines.append(line)
	dest = sys.stdout
	if args.write:
		dest = open(file, "w")
	for line in lines:
		if line[:-1] == args.pattern:
			dest.write(args.toadd + "\n")
		dest.write(line)
	if dest != sys.stdout:
		dest.close()

